<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ²ˆæ˜Ÿå›ï¼æ˜Ÿå…‰å‚™å¿˜éŒ„</title>
    <style>
        :root {
            --star-purple: #e0d7ff;
            --deep-purple: #9a8cff;
            --text-color: #4a4a4a;
            --soft-white: rgba(255, 255, 255, 0.85);
        }

        body {
            font-family: "Microsoft JhengHei", sans-serif;
            background: linear-gradient(135deg, #f5f3ff 0%, #e0d7ff 100%);
            color: var(--text-color);
            margin: 0;
            display: flex;
            justify-content: center;
            min-height: 120vh;
            /* ä¿®æ”¹é‡é»ï¼šå¤§å¹…å¢åŠ åº•éƒ¨ç•™ç™½è‡³ 500pxï¼Œç¢ºä¿æœˆæ›†çµ•å°ä¸æœƒè¢«æ“‹ä½ */
            padding-bottom: 600px; 
        }

        .container {
            width: 90%;
            max-width: 500px;
            margin-top: 30px;
        }

        h1 {
            text-align: center;
            color: var(--deep-purple);
            text-shadow: 1px 1px 2px white;
            margin-bottom: 30px;
        }

        .section {
            background: var(--soft-white);
            border-radius: 15px;
            padding: 20px;
            /* ä¿®æ”¹é‡é»ï¼šå¢åŠ å€å¡Šé–“è·ï¼Œæ‹‰é•·ç¶²ç«™è¦–è¦º */
            margin-bottom: 50px; 
            box-shadow: 0 6px 15px rgba(0,0,0,0.05);
            backdrop-filter: blur(5px);
        }

        h2 {
            font-size: 1.1rem;
            border-left: 4px solid var(--deep-purple);
            padding-left: 10px;
            margin-top: 0;
            margin-bottom: 15px;
        }

        .input-group {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
        }

        input[type="text"], input[type="date"] {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            flex-grow: 1;
            font-family: inherit;
        }

        button {
            cursor: pointer;
            transition: 0.2s;
        }

        .add-btn {
            background: var(--deep-purple);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
        }
        
        .add-btn:hover { background: #8575ff; }

        .task-item, .count-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px dashed #ccc;
        }

        .completed { text-decoration: line-through; color: #888; }

        .delete-btn {
            background: #ff8b8b;
            color: white;
            border: none;
            border-radius: 3px;
            padding: 4px 10px;
            font-size: 0.8rem;
        }

        .today-highlight {
            color: #d4a5ff;
            font-weight: bold;
            text-shadow: 0 0 5px white;
        }

        /* å¿ƒæƒ…æŒ‰éˆ•å€ */
        .mood-selector {
            margin-bottom: 15px;
        }
        .mood-group {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        .mood-btn {
            border: 1px solid var(--deep-purple);
            background: white;
            padding: 8px;
            border-radius: 8px;
            font-size: 0.95rem;
        }
        .mood-btn:hover { 
            background: var(--star-purple); 
            transform: translateY(-2px);
        }

        /* æœˆæ›†æ¨£å¼ */
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            font-weight: bold;
            color: var(--deep-purple);
        }
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            text-align: center;
        }
        .calendar-day-header {
            font-size: 0.8rem;
            color: #888;
            padding-bottom: 5px;
        }
        .calendar-cell {
            background: rgba(255,255,255,0.5);
            aspect-ratio: 1; /* ä¿æŒæ­£æ–¹å½¢ */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 5px;
            font-size: 0.8rem;
            position: relative;
        }
        .calendar-cell.today {
            border: 2px solid var(--deep-purple);
        }
        .mood-icon {
            font-size: 1.2rem;
            margin-top: 2px;
        }

        .random-box {
            background: #fff;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid var(--star-purple);
            text-align: center;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 10px;
            line-height: 1.5;
        }

        /* æ²ˆæ˜Ÿå›å€åŸŸ */
        .character-zone {
            position: fixed;
            left: 20px;
            bottom: 20px;
            display: flex;
            align-items: flex-end;
            pointer-events: none;
            z-index: 1000;
        }

        .avatar {
            width: 110px;
            height: 110px;
            background-image: url('1234.jpg'); 
            background-size: cover;
            background-position: center;
            cursor: pointer;
            pointer-events: auto;
            border-radius: 50%;
            border: 4px solid white; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            transition: transform 0.3s;
        }
        
        .avatar:hover { transform: scale(1.05); }

        .bubble {
            background: white;
            border: 2px solid var(--deep-purple);
            padding: 12px 18px;
            border-radius: 15px;
            margin-bottom: 60px;
            margin-left: 15px;
            max-width: 220px;
            position: relative;
            box-shadow: 2px 2px 10px rgba(0,0,0,0.1);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .bubble::after {
            content: '';
            position: absolute;
            left: -10px;
            bottom: 15px;
            border-width: 10px 10px 10px 0;
            border-style: solid;
            border-color: transparent white transparent transparent;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>âœ¨ æ˜Ÿå…‰å‚™å¿˜éŒ„ âœ¨</h1>

    <div class="section">
        <h2>æ²ˆæ˜Ÿå›çš„å°ä»»å‹™</h2>
        <button class="add-btn" style="width: 100%;" onclick="getRandomTask()">ç²å–ä»Šæ—¥éš¨æ©Ÿæ˜Ÿå…‰ä»»å‹™</button>
        <div class="random-box" id="taskDisplay">é»æ“ŠæŒ‰éˆ•ï¼Œæ¥å–æˆ‘çš„å°ä»»å‹™å§ã€‚</div>
    </div>

    <div class="section">
        <h2>é€±å¹´å€’æ•¸</h2>
        <div class="input-group">
            <input type="text" id="countName" placeholder="ç´€å¿µæ—¥åç¨±...">
            <input type="date" id="countDate">
            <button class="add-btn" onclick="addCountdown()">ç´€éŒ„</button>
        </div>
        <div id="countdownList"></div>
    </div>

    <div class="section">
        <h2>æ¯æ—¥ç›®æ¨™</h2>
        <div class="input-group">
            <input type="text" id="dailyInput" placeholder="è¼¸å…¥ä»Šæ—¥ç›®æ¨™...">
            <button class="add-btn" onclick="addTask('daily')">æ–°å¢</button>
        </div>
        <div id="dailyList"></div>
    </div>

    <div class="section">
        <h2>å¿ƒæƒ…è¨˜éŒ„</h2>
        <div class="mood-selector">
            <label style="font-size:0.9rem; color:#666;">é¸æ“‡æ—¥æœŸï¼š</label>
            <input type="date" id="moodDate" style="margin-bottom: 10px;">
        </div>
        <div class="mood-group">
            <button class="mood-btn" onclick="recordMood('é–‹å¿ƒ')">ğŸ˜Š é–‹å¿ƒ</button>
            <button class="mood-btn" onclick="recordMood('èˆˆå¥®')">ğŸ¤© èˆˆå¥®</button>
            <button class="mood-btn" onclick="recordMood('é›£é')">ğŸ˜¢ é›£é</button>
            <button class="mood-btn" onclick="recordMood('å¥½ç´¯')">ğŸ˜« å¥½ç´¯</button>
            <button class="mood-btn" onclick="recordMood('ç”Ÿæ°£')">ğŸ’¢ ç”Ÿæ°£</button>
            <button class="mood-btn" onclick="recordMood('å¹³éœ')">ğŸ˜Œ å¹³éœ</button>
        </div>
    </div>

    <div class="section">
        <h2>å¿ƒæƒ…æœˆæ›†</h2>
        <div class="calendar-header">
            <button class="add-btn" style="padding: 2px 8px;" onclick="changeMonth(-1)">â®</button>
            <span id="calendarMonthYear"></span>
            <button class="add-btn" style="padding: 2px 8px;" onclick="changeMonth(1)">â¯</button>
        </div>
        <div class="calendar-grid">
            <div class="calendar-day-header">æ—¥</div>
            <div class="calendar-day-header">ä¸€</div>
            <div class="calendar-day-header">äºŒ</div>
            <div class="calendar-day-header">ä¸‰</div>
            <div class="calendar-day-header">å››</div>
            <div class="calendar-day-header">äº”</div>
            <div class="calendar-day-header">å…­</div>
        </div>
        <div class="calendar-grid" id="calendarBody"></div>
    </div>
</div>

<div class="character-zone">
    <div class="avatar" onclick="saySomething('touch')"></div>
    <div class="bubble" id="dialogue">...</div>
</div>

<script>
    // è³‡æ–™åˆå§‹åŒ–
    let dailyTasks = JSON.parse(localStorage.getItem('dailyTasks')) || [];
    let countdowns = JSON.parse(localStorage.getItem('countdowns')) || [];
    let moodHistory = JSON.parse(localStorage.getItem('moodHistory')) || {}; // æ ¼å¼: { "2023-10-01": "é–‹å¿ƒ" }

    // ç•¶å‰æœˆæ›†é¡¯ç¤ºçš„æ—¥æœŸ
    let currentCalendarDate = new Date();

    // é è¨­å¿ƒæƒ…æ—¥æœŸç‚ºä»Šå¤©
    document.getElementById('moodDate').valueAsDate = new Date();

    const moodIcons = {
        "é–‹å¿ƒ": "ğŸ˜Š",
        "èˆˆå¥®": "ğŸ¤©",
        "é›£é": "ğŸ˜¢",
        "å¥½ç´¯": "ğŸ˜«",
        "ç”Ÿæ°£": "ğŸ’¢",
        "å¹³éœ": "ğŸ˜Œ"
    };

    const dialogues = {
        touch: ["å—¯... å¦³åœ¨æ‰¾æˆ‘å—ï¼Ÿ", "åˆ¥æ“”å¿ƒï¼Œæˆ‘ä¸€ç›´éƒ½åœ¨å¦³èº«é‚Šã€‚", "å…‰èŠ’æœƒæŒ‡å¼•å¦³å‰é€²çš„æ–¹å‘ã€‚", "æƒ³å»å“ªè£¡ï¼Ÿæˆ‘é™ªå¦³ã€‚"],
        add: ["æ–°çš„è¨ˆåŠƒå—ï¼Ÿæˆ‘æœƒé™ªå¦³ä¸€èµ·å®Œæˆçš„ã€‚", "è¨˜å¥½äº†ï¼Œé€™ä»¶äº‹å°å¦³å¾ˆé‡è¦å°å§ï¼Ÿ"],
        complete: ["å¦³åšå¾—å¾ˆå¥½ï¼Œè¾›è‹¦äº†ã€‚", "å¦³æœç„¶å¾ˆå‡ºè‰²ï¼Œè¦çµ¦å¦³ä¸€é»çå‹µå—ï¼Ÿ"],
        "é–‹å¿ƒ": ["çœ‹åˆ°å¦³é€™éº¼é–‹å¿ƒï¼Œå…‰èŠ’å¥½åƒéƒ½è®Šäº®äº†ã€‚", "åªè¦å¦³é«˜èˆˆï¼Œæˆ‘ä¹Ÿæœƒè¦ºå¾—å¿ƒæƒ…å¾ˆå¥½ã€‚"],
        "èˆˆå¥®": ["ç™¼ç”Ÿä»€éº¼å¥½äº‹äº†ï¼Ÿæ…¢æ…¢èªªï¼Œæˆ‘è½è‘—ã€‚", "å¦³çœ¼ç›è£¡æœ‰æ˜Ÿæ˜Ÿåœ¨é–ƒã€‚"],
        "é›£é": ["æƒ³å“­å°±å“­å§ï¼Œæˆ‘åœ¨ï¼Œä¸æœƒé›¢é–‹ã€‚", "æ²’äº‹çš„ï¼Œæˆ‘æœƒä¸€ç›´é™ªè‘—å¦³ï¼Œç›´åˆ°å¦³å¥½èµ·ä¾†ã€‚"],
        "å¥½ç´¯": ["è¾›è‹¦äº†ï¼Œå…ˆä¼‘æ¯ä¸€ä¸‹å§ï¼Œæˆ‘å®ˆè‘—å¦³ã€‚", "å°±æ˜¯é€™æ¨£ï¼ŒæŠŠé ­é åœ¨æˆ‘çš„è‚©è†€ä¸Šï¼Œç¡å§ã€‚"],
        "ç”Ÿæ°£": ["èª°æƒ¹å¦³ç”Ÿæ°£äº†ï¼Ÿè¦å»å¹«å¦³æ•™è¨“ä»–å—ï¼Ÿ", "æ·±å‘¼å¸ï¼Œæœ‰æˆ‘åœ¨é€™ï¼Œä¸æ°£äº†ã€‚"],
        "å¹³éœ": ["é€™æ¨£å®‰å®‰éœéœçš„æ™‚åˆ»ï¼Œæ„Ÿè¦ºå¾ˆèˆ’æœã€‚", "å¹³å‡¡çš„æ—¥å­ï¼Œåªè¦æœ‰å¦³åœ¨å°±å¾ˆç‰¹åˆ¥ã€‚"],
        "countdown": ["é€™ä¸€å¤©ä¸çŸ¥ä¸è¦ºå¿«åˆ°äº†å‘¢ã€‚", "å°å¦³ä¾†èªªæ˜¯å¾ˆé‡è¦çš„æ—¥å­å§ï¼Ÿæˆ‘æœƒè¨˜ä¸‹ä¾†çš„ã€‚", "é‚£ä¸€å¤©ï¼Œæˆ‘å€‘æœƒä¸€èµ·åº¦éå—ï¼Ÿ"]
    };

    const randomTasks = [
        "ä»Šå¤©å¤šå–ä¸€é»æ°´ï¼Œç…§é¡§å¥½èº«é«”ã€‚",
        "æŠ¬é ­çœ‹çœ‹å¤©ç©ºï¼Œæ‰¾ä¸€é¡†æœ€äº®çš„æ˜Ÿæ˜Ÿã€‚",
        "çµ¦è‡ªå·±äº”åˆ†é˜ï¼Œéœä¸‹å¿ƒä¾†ä»€éº¼éƒ½åˆ¥æƒ³ã€‚",
        "å°é¡å­è£¡çš„è‡ªå·±ç¬‘ä¸€å€‹ã€‚",
        "ä»Šå¤©æ—©ååˆ†é˜èººåˆ°åºŠä¸Šä¼‘æ¯ã€‚",
        "åƒä¸€é»ç”œçš„æ±è¥¿ï¼Œè®“å¿ƒæƒ…è®Šå¥½ã€‚",
        "è½ä¸€é¦–å¦³æœ€å–œæ­¡çš„æ­Œã€‚",
        "æ·±å‘¼å¸ä¸‰æ¬¡ï¼ŒæŠŠä¸æ„‰å¿«éƒ½åå‡ºä¾†ã€‚",
        "ä»Šå¤©è©¦è‘—å¤šç¨±è®šè‡ªå·±ä¸€é»ã€‚",
        "å¦‚æœç´¯äº†å°±é–‰ä¸Šçœ¼ï¼Œæˆ‘åœ¨å¦³èº«é‚Šã€‚"
    ];

    // --- æ ¸å¿ƒåŠŸèƒ½ ---

    function saySomething(type) {
        const bubble = document.getElementById('dialogue');
        const options = dialogues[type];
        const randomText = options[Math.floor(Math.random() * options.length)];
        bubble.innerText = randomText;
        bubble.style.opacity = 1;
        setTimeout(() => { bubble.style.opacity = 0; }, 4000);
    }

    // --- å¿ƒæƒ…èˆ‡æœˆæ›†åŠŸèƒ½ ---

    function recordMood(mood) {
        const dateInput = document.getElementById('moodDate').value;
        if (!dateInput) return;

        // å„²å­˜å¿ƒæƒ…
        moodHistory[dateInput] = mood;
        localStorage.setItem('moodHistory', JSON.stringify(moodHistory));

        // è§¸ç™¼å°è©± & é‡æ–°æ¸²æŸ“æœˆæ›†
        saySomething(mood);
        renderCalendar();
    }

    function changeMonth(delta) {
        currentCalendarDate.setMonth(currentCalendarDate.getMonth() + delta);
        renderCalendar();
    }

    function renderCalendar() {
        const year = currentCalendarDate.getFullYear();
        const month = currentCalendarDate.getMonth();
        const firstDay = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        
        document.getElementById('calendarMonthYear').innerText = `${year}å¹´ ${month + 1}æœˆ`;
        
        const calendarBody = document.getElementById('calendarBody');
        calendarBody.innerHTML = '';

        // å¡«å……ç©ºç™½æ—¥
        for (let i = 0; i < firstDay; i++) {
            calendarBody.innerHTML += `<div></div>`;
        }

        // å¡«å……æ—¥æœŸ
        for (let day = 1; day <= daysInMonth; day++) {
            // æ ¼å¼åŒ–æ—¥æœŸ key (YYYY-MM-DD) æ³¨æ„æœˆä»½è¦è£œ0
            const monthStr = String(month + 1).padStart(2, '0');
            const dayStr = String(day).padStart(2, '0');
            const dateKey = `${year}-${monthStr}-${dayStr}`;
            
            // æª¢æŸ¥æ˜¯å¦æœ‰å¿ƒæƒ…ç´€éŒ„
            const mood = moodHistory[dateKey];
            const icon = mood ? moodIcons[mood] : '';
            
            // æª¢æŸ¥æ˜¯å¦æ˜¯ä»Šå¤©
            const today = new Date();
            const isToday = (day === today.getDate() && month === today.getMonth() && year === today.getFullYear()) ? 'today' : '';

            calendarBody.innerHTML += `
                <div class="calendar-cell ${isToday}">
                    <span>${day}</span>
                    <span class="mood-icon">${icon}</span>
                </div>
            `;
        }
    }

    // --- å…¶ä»–åŠŸèƒ½ (ä»»å‹™ & å€’æ•¸) ---

    function getRandomTask() {
        const task = randomTasks[Math.floor(Math.random() * randomTasks.length)];
        document.getElementById('taskDisplay').innerText = task;
        saySomething('add');
    }

    function addCountdown() {
        const name = document.getElementById('countName');
        const dateInput = document.getElementById('countDate');
        if (!name.value || !dateInput.value) return;
        
        const dateObj = new Date(dateInput.value);
        countdowns.push({ 
            name: name.value, 
            month: dateObj.getMonth() + 1, 
            day: dateObj.getDate() 
        });
        
        name.value = '';
        dateInput.value = '';
        saySomething('countdown');
        saveAndRender();
    }

    function addTask(type) {
        const input = document.getElementById('dailyInput');
        if (!input.value) return;
        dailyTasks.push({ text: input.value, completed: false });
        input.value = '';
        saySomething('add');
        saveAndRender();
    }

    function toggleTask(index) {
        dailyTasks[index].completed = !dailyTasks[index].completed;
        if (dailyTasks[index].completed) saySomething('complete');
        saveAndRender();
    }

    function deleteTask(type, index) {
        if (type === 'daily') dailyTasks.splice(index, 1);
        else countdowns.splice(index, 1);
        saveAndRender();
    }

    function saveAndRender() {
        localStorage.setItem('dailyTasks', JSON.stringify(dailyTasks));
        localStorage.setItem('countdowns', JSON.stringify(countdowns));
        renderList();
    }

    function renderList() {
        // æ¯æ—¥ä»»å‹™
        document.getElementById('dailyList').innerHTML = dailyTasks.map((t, i) => `
            <div class="task-item">
                <label class="${t.completed ? 'completed' : ''}">
                    <input type="checkbox" ${t.completed ? 'checked' : ''} onchange="toggleTask(${i})">
                    ${t.text}
                </label>
                <button class="delete-btn" onclick="deleteTask('daily', ${i})">åˆªé™¤</button>
            </div>
        `).join('');

        // é€±å¹´å€’æ•¸
        const now = new Date();
        const currentYear = now.getFullYear();
        document.getElementById('countdownList').innerHTML = countdowns.map((c, i) => {
            let target = new Date(currentYear, c.month - 1, c.day);
            if (target.setHours(0,0,0,0) < now.setHours(0,0,0,0)) {
                target = new Date(currentYear + 1, c.month - 1, c.day);
            }
            const diffTime = target.setHours(0,0,0,0) - now.setHours(0,0,0,0);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            let displayText = diffDays === 0 
                ? `<span class="today-highlight">âœ¨ å°±æ˜¯ä»Šå¤© âœ¨</span>` 
                : `é‚„æœ‰ ${diffDays} å¤©`;

            return `
                <div class="count-item">
                    <span><strong>${c.name}</strong> (${c.month}/${c.day})ï¼š${displayText}</span>
                    <button class="delete-btn" onclick="deleteTask('count', ${i})">åˆªé™¤</button>
                </div>
            `;
        }).join('');
    }

    // åˆå§‹åŒ–åŸ·è¡Œ
    renderList();
    renderCalendar();
</script>

</body>
</html>
